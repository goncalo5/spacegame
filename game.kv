

<ResourcesBar@BoxLayout>:
    orientation: "horizontal"
    size_hint_y: None
    height: app.window.height * 0.1
    Button:
        text: "Main"
        on_press:
            app.construction.clean_display()
            app.game.current = "main_screen"
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Metal"
        Label:
            text: str(int(app.metal.current))
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Crystal"
        Label:
            text: str(int(app.crystal.current))
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Deuterium"
        Label:
            text: str(int(app.deuterium.current))

<ButtonUpgrade@Button>:
    size_hint_y: None
    height: 100
    building: None
    building_name: None
    building_level: None
    on_press:
        print("main")
        app.construction.display_costs(root.building)
    RelativeLayout:
        pos: self.parent.pos
        size: self.parent.size
        Label:
            text: "%s" % root.building_name
        Label:
            text: "level: %s" % root.building_level
            size_hint: None, None
            pos_hint: {"right": 1}
        Button:
            text: "+1"
            size_hint: None, None
            pos_hint: {"top": 1}
            on_press:
                root.building.upgrade(root.construction_queue)

<MainScreen@Screen>:
    BoxLayout:
        orientation: "vertical"
        ResourcesBar
        Button:
            text: "Buildings"
            on_press: root.manager.current = "buildings_screen"
        Button:
            text: "Defenses"
            on_press: root.manager.current = "defenses_screen"

<DefensesScreen@Screen>:
    BoxLayout:
        orientation: "vertical"
        ResourcesBar
        BoxLayout:
            id: construction_queue
            orientation: "vertical"
            BoxLayout:
                orientation: "horizontal"
                Label:
                    text: "Construction queue"
                Label:
                    text: "time: %s" % int(app.construction.defenses_queue_time)
                Label:
                    text: "time: %s" % int(app.construction.last_defense_time)
        Button:
            text: "Rocketlauncher"
            on_press:
                app.construction.display_costs(app.rocketlauncher)
            RelativeLayout:
                pos: self.parent.pos
                size: self.parent.size
                Label:
                    text: "%s" % app.rocketlauncher.n
                    size_hint: None, None
                    pos_hint: {"right": 1}
        BoxLayout:
            orientation: "vertical"
            BoxLayout:
                orientation: "horizontal"
                padding: 10
                Label:
                    text: app.construction.name
                TextInput:
                    id: input_construct
                Button:
                    text: "construct"
                    on_press:
                        app.construct_defense(input_construct.text)

            BoxLayout:
                orientation: "horizontal"
                size_hint_h: 0.1
                Label:
                    text: app.construction.metal_cost
                Label:
                    text: app.construction.crystal_cost
                Label:
                    text: app.construction.deuterium_cost
                Label:
                    text: app.construction.time_cost

<BuildingsScreen@Screen>:
    BoxLayout:
        orientation: "vertical"
        ResourcesBar
        Label:
            text: "Buildings"
            size_hint_y: None
            height: app.window.height * 0.05
            canvas.before:
                Color:
                    rgba: .1,.1,.1,1
                Rectangle:
                    pos: self.pos
                    size: self.size
        BoxLayout:
            id: construction_queue
            orientation: "horizontal"
            size_hint_y: None
            height: 0
            Label:
                text: "%s" % app.construction.name
                opacity: app.construction.have_queue
            Label:
                text: "%s" % app.construction.time_left
                opacity: app.construction.have_queue
            Button:
                text: "cancel"
                opacity: app.construction.have_queue
                disabled: not app.construction.have_queue
                on_press:
                    print("cancel")
                    app.construction.cancel()
        RecycleView:
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                canvas.before:
                    Color:
                        rgba: .1,0,0,1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                ButtonUpgrade:
                    building: app.metal_mine
                    building_name: app.metal_mine.name
                    building_level: app.metal_mine.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.crystal_mine
                    building_name: app.crystal_mine.name
                    building_level: app.crystal_mine.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.deuterium_mine
                    building_name: app.deuterium_mine.name
                    building_level: app.deuterium_mine.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.metal_storage
                    building_name: app.metal_storage.name
                    building_level: app.metal_storage.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.crystal_storage
                    building_name: app.crystal_storage.name
                    building_level: app.crystal_storage.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.deuterium_storage
                    building_name: app.deuterium_storage.name
                    building_level: app.deuterium_storage.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.robotics_factory
                    building_name: app.robotics_factory.name
                    building_level: app.robotics_factory.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.shipyard
                    building_name: app.shipyard.name
                    building_level: app.shipyard.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.nanite_factory
                    building_name: app.nanite_factory.name
                    building_level: app.nanite_factory.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.research_lab
                    building_name: app.research_lab.name
                    building_level: app.research_lab.level
                    construction_queue: construction_queue
                ButtonUpgrade:
                    building: app.terraformer
                    building_name: app.terraformer.name
                    building_level: app.terraformer.level
                    construction_queue: construction_queue
        BoxLayout:
            orientation: "vertical"
            Label:
                text: app.construction.name
            BoxLayout:
                orientation: "horizontal"
                size_hint_h: 0.1
                Label:
                    text: app.construction.metal_cost
                Label:
                    text: app.construction.crystal_cost
                Label:
                    text: app.construction.deuterium_cost
                Label:
                    text: app.construction.time_cost

<Game>:
    id: game
    main_screen: main_screen
    buildings_screen: buildings_screen
    defenses_screen: defenses_screen
    MainScreen:
        id: main_screen
        name: "main_screen"
        manager: game
    BuildingsScreen:
        id: buildings_screen
        name: "buildings_screen"
        manager: game
    DefensesScreen:
        id: defenses_screen
        name: "defenses_screen"
        manager: game
